<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.2/knockout-min.js"></script>
</head>

<body>

<h2> KO ymx expression test </h2>

x:<input data-bind="value:x"><br>
m:<input data-bind="value:m"><br>
y:<input data-bind="value:y, enable: !mNaN()"><br>

<p>Initial value of viewmodel updates inputs.</p>
<p>Un update with same value of "m", do not cause updates of "x" or "y", even with notify:always.</p> 

<script>
	$("#name").change(function() {
		$("#msg").text($(this).val());
		if (typeof mychange!=="undefined") mychange();
	});

	var vm = function() {
		var me = this;
		me.x = ko.observable();
		me.m = ko.observable().extend({ notify: 'always' });	// init here do not call the subscribe
		me.y = ko.observable();
		
		var x = me.x;
		var y = me.y;
		var m = me.m;
		
		function checkNaN() {
			return {
				x:isNaN( x()||'a' ),
				m:isNaN( m()||'a' ),
				y:isNaN( y()||'a' ),
				x_infinite:!isFinite( x() ) 
			}
		}
		
		me.mNaN = function() {
			return isNaN( m()||'a' );
		}
		
		x.subscribe( function() {
			// y = m*x
			var nan = checkNaN();
			if (!nan.x && !nan.m) 
				y( m() * x() );
		})
		
		m.subscribe( function() {
			// y = m*x or x = y/m
			var nan = checkNaN();
			if (!nan.x) me.y( m() * x() );
			if (!nan.y) me.x( y() / m() );
		})
		
		y.subscribe( function() {
			// x = y/m
			var nan = checkNaN();
			if (!nan.y && !nan.m) 
				x( y() / m() );
		})
		
		m(1);
		
	} // vm
	
	ko.applyBindings(new vm());	

</script>



</body>

</html>


